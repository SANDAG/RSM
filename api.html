
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://sandag.github.io/rsm/api.html">
      
      
        <link rel="prev" href="visualizer.html">
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.2.6">
    
    
      
        <title>API - SANDAG Rapid Strategic Model</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.0e669242.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="deep-orange">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#application-programming-interface" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="SANDAG Rapid Strategic Model" class="md-header__button md-logo" aria-label="SANDAG Rapid Strategic Model" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SANDAG Rapid Strategic Model
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="grey"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/SANDAG/RSM" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="index.html" class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="development.html" class="md-tabs__link">
        
  
    
  
  Development

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="assessment.html" class="md-tabs__link">
        
  
    
  
  Assessment

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="userguide.html" class="md-tabs__link">
        
  
    
  
  User Guide

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="visualizer.html" class="md-tabs__link">
        
  
    
  
  Visualizer

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="api.html" class="md-tabs__link">
        
  
    
  
  API

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="SANDAG Rapid Strategic Model" class="md-nav__button md-logo" aria-label="SANDAG Rapid Strategic Model" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    SANDAG Rapid Strategic Model
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/SANDAG/RSM" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="development.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="assessment.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Assessment
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="userguide.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="visualizer.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Visualizer
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    API
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="api.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rsm.zone_agg" class="md-nav__link">
    zone_agg
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.zone_agg.aggregate_zones" class="md-nav__link">
    aggregate_zones()
  </a>
  
    <nav class="md-nav" aria-label="aggregate_zones()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rsm.zone_agg.aggregate_zones--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsm.zone_agg.aggregate_zones--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.input_agg" class="md-nav__link">
    input_agg
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.input_agg.agg_input_files" class="md-nav__link">
    agg_input_files()
  </a>
  
    <nav class="md-nav" aria-label="agg_input_files()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rsm.input_agg.agg_input_files--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsm.input_agg.agg_input_files--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.translate" class="md-nav__link">
    translate
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.translate.copy_transit_demand" class="md-nav__link">
    copy_transit_demand()
  </a>
  
    <nav class="md-nav" aria-label="copy_transit_demand()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rsm.translate.copy_transit_demand--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsm.translate.copy_transit_demand--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.translate.translate_emmebank_demand" class="md-nav__link">
    translate_emmebank_demand()
  </a>
  
    <nav class="md-nav" aria-label="translate_emmebank_demand()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rsm.translate.translate_emmebank_demand--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsm.translate.translate_emmebank_demand--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.translate.translate_omx_demand" class="md-nav__link">
    translate_omx_demand()
  </a>
  
    <nav class="md-nav" aria-label="translate_omx_demand()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rsm.translate.translate_omx_demand--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsm.translate.translate_omx_demand--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.sampler" class="md-nav__link">
    sampler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.sampler.rsm_household_sampler" class="md-nav__link">
    rsm_household_sampler()
  </a>
  
    <nav class="md-nav" aria-label="rsm_household_sampler()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rsm.sampler.rsm_household_sampler--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsm.sampler.rsm_household_sampler--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.assembler" class="md-nav__link">
    assembler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.assembler.rsm_assemble" class="md-nav__link">
    rsm_assemble()
  </a>
  
    <nav class="md-nav" aria-label="rsm_assemble()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rsm.assembler.rsm_assemble--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsm.assembler.rsm_assemble--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rsm.zone_agg" class="md-nav__link">
    zone_agg
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.zone_agg.aggregate_zones" class="md-nav__link">
    aggregate_zones()
  </a>
  
    <nav class="md-nav" aria-label="aggregate_zones()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rsm.zone_agg.aggregate_zones--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsm.zone_agg.aggregate_zones--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.input_agg" class="md-nav__link">
    input_agg
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.input_agg.agg_input_files" class="md-nav__link">
    agg_input_files()
  </a>
  
    <nav class="md-nav" aria-label="agg_input_files()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rsm.input_agg.agg_input_files--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsm.input_agg.agg_input_files--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.translate" class="md-nav__link">
    translate
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.translate.copy_transit_demand" class="md-nav__link">
    copy_transit_demand()
  </a>
  
    <nav class="md-nav" aria-label="copy_transit_demand()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rsm.translate.copy_transit_demand--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsm.translate.copy_transit_demand--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.translate.translate_emmebank_demand" class="md-nav__link">
    translate_emmebank_demand()
  </a>
  
    <nav class="md-nav" aria-label="translate_emmebank_demand()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rsm.translate.translate_emmebank_demand--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsm.translate.translate_emmebank_demand--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.translate.translate_omx_demand" class="md-nav__link">
    translate_omx_demand()
  </a>
  
    <nav class="md-nav" aria-label="translate_omx_demand()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rsm.translate.translate_omx_demand--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsm.translate.translate_omx_demand--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.sampler" class="md-nav__link">
    sampler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.sampler.rsm_household_sampler" class="md-nav__link">
    rsm_household_sampler()
  </a>
  
    <nav class="md-nav" aria-label="rsm_household_sampler()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rsm.sampler.rsm_household_sampler--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsm.sampler.rsm_household_sampler--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.assembler" class="md-nav__link">
    assembler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsm.assembler.rsm_assemble" class="md-nav__link">
    rsm_assemble()
  </a>
  
    <nav class="md-nav" aria-label="rsm_assemble()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rsm.assembler.rsm_assemble--parameters" class="md-nav__link">
    Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rsm.assembler.rsm_assemble--returns" class="md-nav__link">
    Returns
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="application-programming-interface">Application Programming Interface<a class="headerlink" href="#application-programming-interface" title="Permanent link"> ¶</a></h1>


<div class="doc doc-object doc-module">



<a id="rsm.zone_agg"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="rsm.zone_agg.aggregate_zones" class="doc doc-heading">
          <code class="codehilite language-python"><span class="n">aggregate_zones</span><span class="p">(</span><span class="n">mgra_gdf</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;kmeans&#39;</span><span class="p">,</span> <span class="n">n_zones</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cluster_factors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cluster_factors_onehot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_xy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">explicit_agg</span><span class="o">=</span><span class="p">(),</span> <span class="n">explicit_col</span><span class="o">=</span><span class="s1">&#39;mgra&#39;</span><span class="p">,</span> <span class="n">agg_instruction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_cluster_ids</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span></code>

<a href="#rsm.zone_agg.aggregate_zones" class="headerlink" title="Permanent link"> ¶</a></h2>


  <div class="doc doc-contents ">
  
      <p>Aggregate zones.</p>
<h4 id="rsm.zone_agg.aggregate_zones--parameters">Parameters<a class="headerlink" href="#rsm.zone_agg.aggregate_zones--parameters" title="Permanent link"> ¶</a></h4>
<p>mgra_gdf : mgra_gdf (GeoDataFrame)
    Geometry and attibutes of MGRAs
method : method (array)
    default {&lsquo;kmeans&rsquo;, &lsquo;agglom&rsquo;, &lsquo;agglom_adj&rsquo;}
n_zones : n_zones (int)
random_state : random_state (RandomState or int)
cluster_factors : cluster_factors (dict)
cluster_factors_onehot : cluster_factors_onehot (dict)
use_xy : use_xy (bool or float)
    Use X and Y coordinates as a cluster factor, use a float to scale the
    x-y coordinates from the CRS if needed.
explicit_agg : explicit_agg (list[int or list])
    A list containing integers (individual MGRAs that should not be aggregated)
    or lists of integers (groups of MGRAs that should be aggregated exactly as
    given, with no less and no more)
explicit_col : explicit_col (str)
    The name of the column containing the ID&rsquo;s from <code>explicit_agg</code>, usually &lsquo;taz&rsquo;
agg_instruction : agg_instruction (dict)
    Dictionary passed to pandas <code>agg</code> that says how to aggregate data columns.
start_cluster_ids : start_cluster_ids (int, default 13)
    Cluster id&rsquo;s start at this value.  Can be 1, but typically SANDAG has the
    smallest id&rsquo;s reserved for external zones, so starting at a greater value
    is typical.</p>
<h4 id="rsm.zone_agg.aggregate_zones--returns">Returns<a class="headerlink" href="#rsm.zone_agg.aggregate_zones--returns" title="Permanent link"> ¶</a></h4>
<p>GeoDataFrame</p>

          <details class="quote">
            <summary>Source code in <code>rsm/zone_agg.py</code></summary>
            <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">aggregate_zones</span><span class="p">(</span>
    <span class="n">mgra_gdf</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;kmeans&quot;</span><span class="p">,</span>
    <span class="n">n_zones</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">cluster_factors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">cluster_factors_onehot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">use_xy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">explicit_agg</span><span class="o">=</span><span class="p">(),</span>
    <span class="n">explicit_col</span><span class="o">=</span><span class="s2">&quot;mgra&quot;</span><span class="p">,</span>
    <span class="n">agg_instruction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">start_cluster_ids</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Aggregate zones.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mgra_gdf : mgra_gdf (GeoDataFrame)</span>
<span class="sd">        Geometry and attibutes of MGRAs</span>
<span class="sd">    method : method (array)</span>
<span class="sd">        default {&#39;kmeans&#39;, &#39;agglom&#39;, &#39;agglom_adj&#39;}</span>
<span class="sd">    n_zones : n_zones (int)</span>
<span class="sd">    random_state : random_state (RandomState or int)</span>
<span class="sd">    cluster_factors : cluster_factors (dict)</span>
<span class="sd">    cluster_factors_onehot : cluster_factors_onehot (dict)</span>
<span class="sd">    use_xy : use_xy (bool or float)</span>
<span class="sd">        Use X and Y coordinates as a cluster factor, use a float to scale the</span>
<span class="sd">        x-y coordinates from the CRS if needed.</span>
<span class="sd">    explicit_agg : explicit_agg (list[int or list])</span>
<span class="sd">        A list containing integers (individual MGRAs that should not be aggregated)</span>
<span class="sd">        or lists of integers (groups of MGRAs that should be aggregated exactly as</span>
<span class="sd">        given, with no less and no more)</span>
<span class="sd">    explicit_col : explicit_col (str)</span>
<span class="sd">        The name of the column containing the ID&#39;s from `explicit_agg`, usually &#39;taz&#39;</span>
<span class="sd">    agg_instruction : agg_instruction (dict)</span>
<span class="sd">        Dictionary passed to pandas `agg` that says how to aggregate data columns.</span>
<span class="sd">    start_cluster_ids : start_cluster_ids (int, default 13)</span>
<span class="sd">        Cluster id&#39;s start at this value.  Can be 1, but typically SANDAG has the</span>
<span class="sd">        smallest id&#39;s reserved for external zones, so starting at a greater value</span>
<span class="sd">        is typical.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    GeoDataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">cluster_factors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cluster_factors</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">start_cluster_ids</span>
    <span class="k">if</span> <span class="n">explicit_agg</span><span class="p">:</span>
        <span class="n">explicit_agg_ids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">explicit_agg</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
                <span class="n">explicit_agg_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">explicit_agg_ids</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">explicit_col</span> <span class="o">==</span> <span class="n">mgra_gdf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">mgra_gdf</span> <span class="o">=</span> <span class="n">mgra_gdf</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">mgra_gdf</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">mgra_gdf</span><span class="p">[</span><span class="n">explicit_col</span><span class="p">]</span>
        <span class="n">in_explicit</span> <span class="o">=</span> <span class="n">mgra_gdf</span><span class="p">[</span><span class="n">explicit_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">explicit_agg_ids</span><span class="p">)</span>
        <span class="n">mgra_gdf_algo</span> <span class="o">=</span> <span class="n">mgra_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">in_explicit</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">mgra_gdf_explicit</span> <span class="o">=</span> <span class="n">mgra_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">in_explicit</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">mgra_gdf_explicit</span><span class="p">[</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mgra_gdf_explicit</span><span class="p">[</span><span class="n">explicit_col</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="n">explicit_agg_ids</span>
        <span class="p">)</span>
        <span class="n">n_zones_algorithm</span> <span class="o">=</span> <span class="n">n_zones</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span>
            <span class="n">mgra_gdf_explicit</span><span class="p">[</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mgra_gdf_algo</span> <span class="o">=</span> <span class="n">mgra_gdf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">mgra_gdf_explicit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">n_zones_algorithm</span> <span class="o">=</span> <span class="n">n_zones</span>

    <span class="k">if</span> <span class="n">use_xy</span><span class="p">:</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="n">mgra_gdf_algo</span><span class="o">.</span><span class="n">centroid</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
        <span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="n">use_xy</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="o">*</span> <span class="n">use_xy</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">factors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">cf</span><span class="p">,</span> <span class="n">cf_wgt</span> <span class="ow">in</span> <span class="n">cluster_factors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">factors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cf_wgt</span> <span class="o">*</span> <span class="n">mgra_gdf_algo</span><span class="p">[</span><span class="n">cf</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">cluster_factors_onehot</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">cf</span><span class="p">,</span> <span class="n">cf_wgt</span> <span class="ow">in</span> <span class="n">cluster_factors_onehot</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">factors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cf_wgt</span> <span class="o">*</span> <span class="n">OneHotEncoder</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">mgra_gdf_algo</span><span class="p">[[</span><span class="n">cf</span><span class="p">]]))</span>
        <span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">hstack</span>

        <span class="n">factors2d</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">factors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">factors2d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">factors2d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">(</span><span class="n">factors2d</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">factors</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;kmeans&quot;</span><span class="p">:</span>
        <span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">n_zones_algorithm</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="n">kmeans</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">cluster_id</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">labels_</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;agglom&quot;</span><span class="p">:</span>
        <span class="n">agglom</span> <span class="o">=</span> <span class="n">AgglomerativeClustering</span><span class="p">(</span>
            <span class="n">n_clusters</span><span class="o">=</span><span class="n">n_zones_algorithm</span><span class="p">,</span> <span class="n">affinity</span><span class="o">=</span><span class="s2">&quot;euclidean&quot;</span><span class="p">,</span> <span class="n">linkage</span><span class="o">=</span><span class="s2">&quot;ward&quot;</span>
        <span class="p">)</span>
        <span class="n">agglom</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">cluster_id</span> <span class="o">=</span> <span class="n">agglom</span><span class="o">.</span><span class="n">labels_</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;agglom_adj&quot;</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">libpysal.weights</span> <span class="kn">import</span> <span class="n">Rook</span>

        <span class="n">w_rook</span> <span class="o">=</span> <span class="n">Rook</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">mgra_gdf_algo</span><span class="p">)</span>
        <span class="n">adj_mat</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">adjacency_matrix</span><span class="p">(</span><span class="n">w_rook</span><span class="o">.</span><span class="n">to_networkx</span><span class="p">())</span>
        <span class="n">agglom</span> <span class="o">=</span> <span class="n">AgglomerativeClustering</span><span class="p">(</span>
            <span class="n">n_clusters</span><span class="o">=</span><span class="n">n_zones_algorithm</span><span class="p">,</span>
            <span class="n">affinity</span><span class="o">=</span><span class="s2">&quot;euclidean&quot;</span><span class="p">,</span>
            <span class="n">linkage</span><span class="o">=</span><span class="s2">&quot;ward&quot;</span><span class="p">,</span>
            <span class="n">connectivity</span><span class="o">=</span><span class="n">adj_mat</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">agglom</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">cluster_id</span> <span class="o">=</span> <span class="n">agglom</span><span class="o">.</span><span class="n">labels_</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
    <span class="n">mgra_gdf_algo</span><span class="p">[</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cluster_id</span>

    <span class="k">if</span> <span class="n">mgra_gdf_explicit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">mgra_gdf_explicit</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">combined</span> <span class="o">=</span> <span class="n">merge_zone_data</span><span class="p">(</span>
            <span class="n">mgra_gdf_algo</span><span class="p">,</span>
            <span class="n">agg_instruction</span><span class="p">,</span>
            <span class="n">cluster_id</span><span class="o">=</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">combined</span><span class="p">[</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="n">n_zones_algorithm</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pending</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="p">[</span><span class="n">mgra_gdf_algo</span><span class="p">,</span> <span class="n">mgra_gdf_explicit</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;... merging </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">pending</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">merge_zone_data</span><span class="p">(</span>
                    <span class="n">df</span><span class="p">,</span>
                    <span class="n">agg_instruction</span><span class="p">,</span>
                    <span class="n">cluster_id</span><span class="o">=</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">,</span>
                <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="n">pending</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="n">n_zones_algorithm</span><span class="p">))</span>

        <span class="n">pending</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pending</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span>
            <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">pending</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">pending</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="n">pending</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pending</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span>
            <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">pending</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">pending</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="n">combined</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">pending</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">combined</span> <span class="o">=</span> <span class="n">combined</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">combined</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<a id="rsm.input_agg"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="rsm.input_agg.agg_input_files" class="doc doc-heading">
          <code class="codehilite language-python"><span class="n">agg_input_files</span><span class="p">(</span><span class="n">model_dir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">rsm_dir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">taz_cwk_file</span><span class="o">=</span><span class="s1">&#39;taz_crosswalk.csv&#39;</span><span class="p">,</span> <span class="n">mgra_cwk_file</span><span class="o">=</span><span class="s1">&#39;mgra_crosswalk.csv&#39;</span><span class="p">,</span> <span class="n">agg_zones</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">ext_zones</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">input_files</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;microMgraEquivMinutes.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;microMgraTapEquivMinutes.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;walkMgraTapEquivMinutes.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;walkMgraEquivMinutes.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;bikeTazLogsum.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;bikeMgraLogsum.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;zone.term&#39;</span><span class="p">,</span> <span class="s1">&#39;zones.park&#39;</span><span class="p">,</span> <span class="s1">&#39;tap.ptype&#39;</span><span class="p">,</span> <span class="s1">&#39;accessam.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;ParkLocationAlts.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;CrossBorderDestinationChoiceSoaAlternatives.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;TourDcSoaDistanceAlts.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;DestinationChoiceAlternatives.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;SoaTazDistAlts.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;TripMatrices.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;transponderModelAccessibilities.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;crossBorderTours.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;internalExternalTrips.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;visitorTours.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;visitorTrips.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;householdAVTrips.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;crossBorderTrips.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;TNCTrips.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;airport_out.SAN.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;airport_out.CBX.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;TNCtrips.csv&#39;</span><span class="p">])</span></code>

<a href="#rsm.input_agg.agg_input_files" class="headerlink" title="Permanent link"> ¶</a></h2>


  <div class="doc doc-contents ">
  
      <h4 id="rsm.input_agg.agg_input_files--parameters">Parameters<a class="headerlink" href="#rsm.input_agg.agg_input_files--parameters" title="Permanent link"> ¶</a></h4>
<p>model_dir : model_dir (path_like)
    path to full model run, default &ldquo;.&rdquo;
rsm_dir : rsm_dir (path_like)
    path to RSM, default &ldquo;.&rdquo;
taz_cwk_file : taz_cwk_file (csv file)
    default taz_crosswalk.csv
    taz to aggregated zones file. Should be located in RSM input folder
mgra_cwk_file : mgra_cwk_file (csv file)
    default mgra_crosswalk.csv
    mgra to aggregated zones file. Should be located in RSM input folder
input_files : input_files (csv + other files)
    list of input files to be aggregated. 
    Should include the following files
        &ldquo;microMgraEquivMinutes.csv&rdquo;, &ldquo;microMgraTapEquivMinutes.csv&rdquo;, 
        &ldquo;walkMgraTapEquivMinutes.csv&rdquo;, &ldquo;walkMgraEquivMinutes.csv&rdquo;, &ldquo;bikeTazLogsum.csv&rdquo;,
        &ldquo;bikeMgraLogsum.csv&rdquo;, &ldquo;zone.term&rdquo;, &ldquo;zones.park&rdquo;, &ldquo;tap.ptype&rdquo;, &ldquo;accessam.csv&rdquo;,
        &ldquo;ParkLocationAlts.csv&rdquo;, &ldquo;CrossBorderDestinationChoiceSoaAlternatives.csv&rdquo;,
        &ldquo;TourDcSoaDistanceAlts.csv&rdquo;, &ldquo;DestinationChoiceAlternatives.csv&rdquo;, &ldquo;SoaTazDistAlts.csv&rdquo;,
        &ldquo;TripMatrices.csv&rdquo;, &ldquo;transponderModelAccessibilities.csv&rdquo;, &ldquo;crossBorderTours.csv&rdquo;,
        &ldquo;internalExternalTrips.csv&rdquo;, &ldquo;visitorTours.csv&rdquo;, &ldquo;visitorTrips.csv&rdquo;, &ldquo;householdAVTrips.csv&rdquo;,
        &ldquo;crossBorderTrips.csv&rdquo;, &ldquo;TNCTrips.csv&rdquo;, &ldquo;airport_out.SAN.csv&rdquo;, &ldquo;airport_out.CBX.csv&rdquo;,
        &ldquo;TNCtrips.csv&rdquo;</p>
<h4 id="rsm.input_agg.agg_input_files--returns">Returns<a class="headerlink" href="#rsm.input_agg.agg_input_files--returns" title="Permanent link"> ¶</a></h4>
<p>Aggregated files in the RSM input/output/uec directory</p>

          <details class="quote">
            <summary>Source code in <code>rsm/input_agg.py</code></summary>
            <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">agg_input_files</span><span class="p">(</span>
    <span class="n">model_dir</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> 
    <span class="n">rsm_dir</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="n">taz_cwk_file</span> <span class="o">=</span> <span class="s2">&quot;taz_crosswalk.csv&quot;</span><span class="p">,</span>
    <span class="n">mgra_cwk_file</span> <span class="o">=</span> <span class="s2">&quot;mgra_crosswalk.csv&quot;</span><span class="p">,</span>
    <span class="n">agg_zones</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
    <span class="n">ext_zones</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">input_files</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;microMgraEquivMinutes.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;microMgraTapEquivMinutes.csv&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;walkMgraTapEquivMinutes.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;walkMgraEquivMinutes.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;bikeTazLogsum.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bikeMgraLogsum.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;zone.term&quot;</span><span class="p">,</span> <span class="s2">&quot;zones.park&quot;</span><span class="p">,</span> <span class="s2">&quot;tap.ptype&quot;</span><span class="p">,</span> <span class="s2">&quot;accessam.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ParkLocationAlts.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;CrossBorderDestinationChoiceSoaAlternatives.csv&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;TourDcSoaDistanceAlts.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;DestinationChoiceAlternatives.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;SoaTazDistAlts.csv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TripMatrices.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;transponderModelAccessibilities.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;crossBorderTours.csv&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;internalExternalTrips.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;visitorTours.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;visitorTrips.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;householdAVTrips.csv&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;crossBorderTrips.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;TNCTrips.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;airport_out.SAN.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;airport_out.CBX.csv&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;TNCtrips.csv&quot;</span><span class="p">]</span>
    <span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model_dir : model_dir (path_like)</span>
<span class="sd">            path to full model run, default &quot;.&quot;</span>
<span class="sd">        rsm_dir : rsm_dir (path_like)</span>
<span class="sd">            path to RSM, default &quot;.&quot;</span>
<span class="sd">        taz_cwk_file : taz_cwk_file (csv file)</span>
<span class="sd">            default taz_crosswalk.csv</span>
<span class="sd">            taz to aggregated zones file. Should be located in RSM input folder</span>
<span class="sd">        mgra_cwk_file : mgra_cwk_file (csv file)</span>
<span class="sd">            default mgra_crosswalk.csv</span>
<span class="sd">            mgra to aggregated zones file. Should be located in RSM input folder</span>
<span class="sd">        input_files : input_files (csv + other files)</span>
<span class="sd">            list of input files to be aggregated. </span>
<span class="sd">            Should include the following files</span>
<span class="sd">                &quot;microMgraEquivMinutes.csv&quot;, &quot;microMgraTapEquivMinutes.csv&quot;, </span>
<span class="sd">                &quot;walkMgraTapEquivMinutes.csv&quot;, &quot;walkMgraEquivMinutes.csv&quot;, &quot;bikeTazLogsum.csv&quot;,</span>
<span class="sd">                &quot;bikeMgraLogsum.csv&quot;, &quot;zone.term&quot;, &quot;zones.park&quot;, &quot;tap.ptype&quot;, &quot;accessam.csv&quot;,</span>
<span class="sd">                &quot;ParkLocationAlts.csv&quot;, &quot;CrossBorderDestinationChoiceSoaAlternatives.csv&quot;,</span>
<span class="sd">                &quot;TourDcSoaDistanceAlts.csv&quot;, &quot;DestinationChoiceAlternatives.csv&quot;, &quot;SoaTazDistAlts.csv&quot;,</span>
<span class="sd">                &quot;TripMatrices.csv&quot;, &quot;transponderModelAccessibilities.csv&quot;, &quot;crossBorderTours.csv&quot;,</span>
<span class="sd">                &quot;internalExternalTrips.csv&quot;, &quot;visitorTours.csv&quot;, &quot;visitorTrips.csv&quot;, &quot;householdAVTrips.csv&quot;,</span>
<span class="sd">                &quot;crossBorderTrips.csv&quot;, &quot;TNCTrips.csv&quot;, &quot;airport_out.SAN.csv&quot;, &quot;airport_out.CBX.csv&quot;,</span>
<span class="sd">                &quot;TNCtrips.csv&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Aggregated files in the RSM input/output/uec directory</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df_clusters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">taz_cwk_file</span><span class="p">))</span>
    <span class="n">df_clusters</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span> <span class="n">df_clusters</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">dict_clusters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df_clusters</span><span class="p">[</span><span class="s1">&#39;taz&#39;</span><span class="p">],</span> <span class="n">df_clusters</span><span class="p">[</span><span class="s1">&#39;cluster_id&#39;</span><span class="p">]))</span>

    <span class="n">mgra_cwk</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">mgra_cwk_file</span><span class="p">))</span>
    <span class="n">mgra_cwk</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span> <span class="n">mgra_cwk</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">mgra_cwk</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">[</span><span class="s1">&#39;mgra&#39;</span><span class="p">],</span> <span class="n">mgra_cwk</span><span class="p">[</span><span class="s1">&#39;cluster_id&#39;</span><span class="p">]))</span>

    <span class="n">taz_zones</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">agg_zones</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">ext_zones</span><span class="p">)</span>
    <span class="n">mgra_zones</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">agg_zones</span><span class="p">)</span>

    <span class="c1"># aggregating microMgraEquivMinutes.csv</span>
    <span class="k">if</span> <span class="s2">&quot;microMgraEquivMinutes.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - microMgraEquivMinutes.csv&quot;</span><span class="p">)</span>
        <span class="n">df_mm_eqmin</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;microMgraEquivMinutes.csv&quot;</span><span class="p">))</span>
        <span class="n">df_mm_eqmin</span><span class="p">[</span><span class="s1">&#39;i_new&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_mm_eqmin</span><span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>
        <span class="n">df_mm_eqmin</span><span class="p">[</span><span class="s1">&#39;j_new&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_mm_eqmin</span><span class="p">[</span><span class="s1">&#39;j&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>

        <span class="n">df_mm_eqmin_agg</span> <span class="o">=</span> <span class="n">df_mm_eqmin</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;i_new&#39;</span><span class="p">,</span> <span class="s1">&#39;j_new&#39;</span><span class="p">])[</span><span class="s1">&#39;walkTime&#39;</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">,</span> <span class="s1">&#39;mmTime&#39;</span><span class="p">,</span> <span class="s1">&#39;mmCost&#39;</span><span class="p">,</span> <span class="s1">&#39;mtTime&#39;</span><span class="p">,</span> <span class="s1">&#39;mtCost&#39;</span><span class="p">,</span>
       <span class="s1">&#39;mmGenTime&#39;</span><span class="p">,</span> <span class="s1">&#39;mtGenTime&#39;</span><span class="p">,</span> <span class="s1">&#39;minTime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="n">df_mm_eqmin_agg</span> <span class="o">=</span> <span class="n">df_mm_eqmin_agg</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;i_new&#39;</span> <span class="p">:</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;j_new&#39;</span> <span class="p">:</span> <span class="s1">&#39;j&#39;</span><span class="p">})</span>
        <span class="n">df_mm_eqmin_agg</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;microMgraEquivMinutes.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;microMgraEquivMinutes.csv&quot;</span><span class="p">)</span>


    <span class="c1"># aggregating microMgraTapEquivMinutes.csv&quot;   </span>
    <span class="k">if</span> <span class="s2">&quot;microMgraTapEquivMinutes.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - microMgraTapEquivMinutes.csv&quot;</span><span class="p">)</span>
        <span class="n">df_mm_tap</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;microMgraTapEquivMinutes.csv&quot;</span><span class="p">))</span>
        <span class="n">df_mm_tap</span><span class="p">[</span><span class="s1">&#39;mgra&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_mm_tap</span><span class="p">[</span><span class="s1">&#39;mgra&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>

        <span class="n">df_mm_tap_agg</span> <span class="o">=</span> <span class="n">df_mm_tap</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;mgra&#39;</span><span class="p">,</span> <span class="s1">&#39;tap&#39;</span><span class="p">])[</span><span class="s1">&#39;walkTime&#39;</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">,</span> <span class="s1">&#39;mmTime&#39;</span><span class="p">,</span> <span class="s1">&#39;mmCost&#39;</span><span class="p">,</span> <span class="s1">&#39;mtTime&#39;</span><span class="p">,</span>
       <span class="s1">&#39;mtCost&#39;</span><span class="p">,</span> <span class="s1">&#39;mmGenTime&#39;</span><span class="p">,</span> <span class="s1">&#39;mtGenTime&#39;</span><span class="p">,</span> <span class="s1">&#39;minTime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="n">df_mm_tap_agg</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;microMgraTapEquivMinutes.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;microMgraTapEquivMinutes.csv&quot;</span><span class="p">)</span>

    <span class="c1"># aggregating walkMgraTapEquivMinutes.csv</span>
    <span class="k">if</span> <span class="s2">&quot;walkMgraTapEquivMinutes.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - walkMgraTapEquivMinutes.csv&quot;</span><span class="p">)</span>
        <span class="n">df_wlk_mgra_tap</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;walkMgraTapEquivMinutes.csv&quot;</span><span class="p">))</span>
        <span class="n">df_wlk_mgra_tap</span><span class="p">[</span><span class="s2">&quot;mgra&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_wlk_mgra_tap</span><span class="p">[</span><span class="s2">&quot;mgra&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>

        <span class="n">df_wlk_mgra_agg</span> <span class="o">=</span> <span class="n">df_wlk_mgra_tap</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;mgra&quot;</span><span class="p">,</span> <span class="s2">&quot;tap&quot;</span><span class="p">])[</span><span class="s2">&quot;boardingPerceived&quot;</span><span class="p">,</span> <span class="s2">&quot;boardingActual&quot;</span><span class="p">,</span><span class="s2">&quot;alightingPerceived&quot;</span><span class="p">,</span><span class="s2">&quot;alightingActual&quot;</span><span class="p">,</span><span class="s2">&quot;boardingGain&quot;</span><span class="p">,</span><span class="s2">&quot;alightingGain&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">df_wlk_mgra_agg</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;walkMgraTapEquivMinutes.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;walkMgraTapEquivMinutes.csv&quot;</span><span class="p">)</span>

    <span class="c1"># aggregating walkMgraEquivMinutes.csv</span>
    <span class="k">if</span> <span class="s2">&quot;walkMgraEquivMinutes.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - walkMgraEquivMinutes.csv&quot;</span><span class="p">)</span>
        <span class="n">df_wlk_min</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;walkMgraEquivMinutes.csv&quot;</span><span class="p">))</span>
        <span class="n">df_wlk_min</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_wlk_min</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>
        <span class="n">df_wlk_min</span><span class="p">[</span><span class="s2">&quot;j&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_wlk_min</span><span class="p">[</span><span class="s2">&quot;j&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>

        <span class="n">df_wlk_min_agg</span> <span class="o">=</span> <span class="n">df_wlk_min</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;j&quot;</span><span class="p">])[</span><span class="s2">&quot;percieved&quot;</span><span class="p">,</span><span class="s2">&quot;actual&quot;</span><span class="p">,</span> <span class="s2">&quot;gain&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="n">df_wlk_min_agg</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;walkMgraEquivMinutes.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;walkMgraEquivMinutes.csv&quot;</span><span class="p">)</span>

    <span class="c1"># aggregating biketazlogsum</span>
    <span class="k">if</span> <span class="s2">&quot;bikeTazLogsum.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - bikeTazLogsum.csv&quot;</span><span class="p">)</span>
        <span class="n">bike_taz</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;bikeTazLogsum.csv&quot;</span><span class="p">))</span>

        <span class="n">bike_taz</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bike_taz</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>
        <span class="n">bike_taz</span><span class="p">[</span><span class="s2">&quot;j&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bike_taz</span><span class="p">[</span><span class="s2">&quot;j&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>

        <span class="n">bike_taz_agg</span> <span class="o">=</span> <span class="n">bike_taz</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;j&quot;</span><span class="p">])[</span><span class="s2">&quot;logsum&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">bike_taz_agg</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;bikeTazLogsum.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;bikeTazLogsum.csv&quot;</span><span class="p">)</span>

    <span class="c1"># aggregating bikeMgraLogsum.csv</span>
    <span class="k">if</span> <span class="s2">&quot;bikeMgraLogsum.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - bikeMgraLogsum.csv&quot;</span><span class="p">)</span>
        <span class="n">bike_mgra</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;bikeMgraLogsum.csv&quot;</span><span class="p">))</span>
        <span class="n">bike_mgra</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bike_mgra</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>
        <span class="n">bike_mgra</span><span class="p">[</span><span class="s2">&quot;j&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bike_mgra</span><span class="p">[</span><span class="s2">&quot;j&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>

        <span class="n">bike_mgra_agg</span> <span class="o">=</span> <span class="n">bike_mgra</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;j&quot;</span><span class="p">])[</span><span class="s2">&quot;logsum&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">bike_mgra_agg</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;bikeMgraLogsum.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;bikeMgraLogsum.csv&quot;</span><span class="p">)</span>

    <span class="c1"># aggregating zone.term</span>
    <span class="k">if</span> <span class="s2">&quot;zone.term&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - zone.term&quot;</span><span class="p">)</span>
        <span class="n">df_zone_term</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_fwf</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;zone.term&quot;</span><span class="p">),</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">df_zone_term</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;taz&quot;</span><span class="p">,</span> <span class="s2">&quot;terminal_time&quot;</span><span class="p">]</span>

        <span class="n">df_agg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_zone_term</span><span class="p">,</span> <span class="n">df_clusters</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s2">&quot;taz&quot;</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="n">df_zones_agg</span> <span class="o">=</span> <span class="n">df_agg</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">])[</span><span class="s1">&#39;terminal_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="n">df_zones_agg</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;taz&quot;</span><span class="p">,</span> <span class="s2">&quot;terminal_time&quot;</span><span class="p">]</span>
        <span class="n">df_zones_agg</span><span class="o">.</span><span class="n">to_fwf</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;zone.term&quot;</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;zone.term&quot;</span><span class="p">)</span>

    <span class="c1"># aggregating zones.park</span>
    <span class="k">if</span> <span class="s2">&quot;zones.park&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - zone.park&quot;</span><span class="p">)</span>
        <span class="n">df_zones_park</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_fwf</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;zone.park&quot;</span><span class="p">),</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">df_zones_park</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;taz&quot;</span><span class="p">,</span> <span class="s2">&quot;park_zones&quot;</span><span class="p">]</span>

        <span class="n">df_zones_park_agg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_zones_park</span><span class="p">,</span> <span class="n">df_clusters</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s2">&quot;taz&quot;</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="n">df_zones_park_agg</span> <span class="o">=</span> <span class="n">df_zones_park_agg</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">])[</span><span class="s1">&#39;park_zones&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">df_zones_park_agg</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;taz&quot;</span><span class="p">,</span> <span class="s2">&quot;park_zones&quot;</span><span class="p">]</span>
        <span class="n">df_zones_park_agg</span><span class="o">.</span><span class="n">to_fwf</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;zone.park&quot;</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;zone.park&quot;</span><span class="p">)</span>


    <span class="c1"># aggregating tap.ptype </span>
    <span class="k">if</span> <span class="s2">&quot;tap.ptype&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - tap.ptype&quot;</span><span class="p">)</span>
        <span class="n">df_tap_ptype</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_fwf</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;tap.ptype&quot;</span><span class="p">),</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">df_tap_ptype</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;tap&quot;</span><span class="p">,</span> <span class="s2">&quot;lot id&quot;</span><span class="p">,</span> <span class="s2">&quot;parking type&quot;</span><span class="p">,</span> <span class="s2">&quot;taz&quot;</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="s2">&quot;distance&quot;</span><span class="p">,</span> <span class="s2">&quot;transit mode&quot;</span><span class="p">]</span>

        <span class="n">df_tap_ptype</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_tap_ptype</span><span class="p">,</span> <span class="n">df_clusters</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s2">&quot;taz&quot;</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>

        <span class="n">df_tap_ptype</span> <span class="o">=</span> <span class="n">df_tap_ptype</span><span class="p">[[</span><span class="s2">&quot;tap&quot;</span><span class="p">,</span> <span class="s2">&quot;lot id&quot;</span><span class="p">,</span> <span class="s2">&quot;parking type&quot;</span><span class="p">,</span> <span class="s2">&quot;cluster_id&quot;</span><span class="p">,</span> <span class="s2">&quot;capacity&quot;</span><span class="p">,</span> <span class="s2">&quot;distance&quot;</span><span class="p">,</span> <span class="s2">&quot;transit mode&quot;</span><span class="p">]]</span>
        <span class="n">df_tap_ptype</span> <span class="o">=</span> <span class="n">df_tap_ptype</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">:</span> <span class="s2">&quot;taz&quot;</span><span class="p">})</span>
        <span class="c1">#df_tap_ptype.to_fwf(os.path.join(rsm_dir, &quot;input&quot;, &quot;tap.ptype&quot;))</span>

        <span class="n">widths</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;tap.ptype&quot;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_tap_ptype</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">field1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">widths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">field2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">widths</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">field3</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">widths</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">field4</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">widths</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">field5</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">widths</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                <span class="n">field6</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">widths</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                <span class="n">field7</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">widths</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">field1</span><span class="si">}{</span><span class="n">field2</span><span class="si">}{</span><span class="n">field3</span><span class="si">}{</span><span class="n">field4</span><span class="si">}{</span><span class="n">field5</span><span class="si">}{</span><span class="n">field6</span><span class="si">}{</span><span class="n">field7</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;tap.ptype&quot;</span><span class="p">)</span>

    <span class="c1">#aggregating accessam.csv</span>
    <span class="k">if</span> <span class="s2">&quot;accessam.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - accessam.csv&quot;</span><span class="p">)</span>
        <span class="n">df_acc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;accessam.csv&quot;</span><span class="p">),</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">df_acc</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;TAZ&#39;</span><span class="p">,</span> <span class="s1">&#39;TAP&#39;</span><span class="p">,</span> <span class="s1">&#39;TIME&#39;</span><span class="p">,</span> <span class="s1">&#39;DISTANCE&#39;</span><span class="p">,</span> <span class="s1">&#39;MODE&#39;</span><span class="p">]</span>

        <span class="n">df_acc</span><span class="p">[</span><span class="s1">&#39;TAZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_acc</span><span class="p">[</span><span class="s1">&#39;TAZ&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>
        <span class="n">df_acc_agg</span> <span class="o">=</span> <span class="n">df_acc</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;TAZ&#39;</span><span class="p">,</span> <span class="s1">&#39;TAP&#39;</span><span class="p">,</span> <span class="s1">&#39;MODE&#39;</span><span class="p">])[</span><span class="s1">&#39;TIME&#39;</span><span class="p">,</span> <span class="s1">&#39;DISTANCE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">df_acc_agg</span> <span class="o">=</span> <span class="n">df_acc_agg</span><span class="p">[[</span><span class="s2">&quot;TAZ&quot;</span><span class="p">,</span> <span class="s2">&quot;TAP&quot;</span><span class="p">,</span> <span class="s2">&quot;TIME&quot;</span><span class="p">,</span> <span class="s2">&quot;DISTANCE&quot;</span><span class="p">,</span> <span class="s2">&quot;MODE&quot;</span><span class="p">]]</span>

        <span class="n">df_acc_agg</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;accessam.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;accessam.csv&quot;</span><span class="p">)</span>

    <span class="c1"># aggregating ParkLocationAlts.csv</span>
    <span class="k">if</span> <span class="s2">&quot;ParkLocationAlts.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - ParkLocationAlts.csv&quot;</span><span class="p">)</span>
        <span class="n">df_park</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;uec&quot;</span><span class="p">,</span> <span class="s2">&quot;ParkLocationAlts.csv&quot;</span><span class="p">))</span>
        <span class="n">df_park</span><span class="p">[</span><span class="s1">&#39;mgra_new&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_park</span><span class="p">[</span><span class="s2">&quot;mgra&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>
        <span class="n">df_park_agg</span> <span class="o">=</span> <span class="n">df_park</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;mgra_new&quot;</span><span class="p">])[</span><span class="s2">&quot;parkarea&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span> <span class="c1"># assuming 1 is &quot;parking&quot; and 2 is &quot;no parking&quot;</span>
        <span class="n">df_park_agg</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_park_agg</span><span class="p">))]</span>

        <span class="n">df_park_agg</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;mgra&quot;</span><span class="p">,</span> <span class="s2">&quot;parkarea&quot;</span><span class="p">]</span>
        <span class="n">df_park_agg</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;uec&quot;</span><span class="p">,</span> <span class="s2">&quot;ParkLocationAlts.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;ParkLocationAlts.csv&quot;</span><span class="p">)</span>

    <span class="c1"># aggregating CrossBorderDestinationChoiceSoaAlternatives.csv</span>
    <span class="k">if</span> <span class="s2">&quot;CrossBorderDestinationChoiceSoaAlternatives.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - CrossBorderDestinationChoiceSoaAlternatives.csv&quot;</span><span class="p">)</span>
        <span class="n">df_cb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;uec&quot;</span><span class="p">,</span><span class="s2">&quot;CrossBorderDestinationChoiceSoaAlternatives.csv&quot;</span><span class="p">))</span>

        <span class="n">df_cb</span><span class="p">[</span><span class="s2">&quot;mgra_entry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_cb</span><span class="p">[</span><span class="s2">&quot;mgra_entry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>
        <span class="n">df_cb</span><span class="p">[</span><span class="s2">&quot;mgra_return&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_cb</span><span class="p">[</span><span class="s2">&quot;mgra_return&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>
        <span class="n">df_cb</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_cb</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>

        <span class="n">df_cb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_cb</span><span class="p">,</span> <span class="n">df_clusters</span><span class="p">,</span> <span class="n">left_on</span> <span class="o">=</span> <span class="s2">&quot;dest&quot;</span><span class="p">,</span> <span class="n">right_on</span> <span class="o">=</span> <span class="s2">&quot;taz&quot;</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="n">df_cb</span> <span class="o">=</span> <span class="n">df_cb</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;dest&quot;</span><span class="p">,</span> <span class="s2">&quot;taz&quot;</span><span class="p">])</span>
        <span class="n">df_cb</span> <span class="o">=</span> <span class="n">df_cb</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cluster_id&#39;</span> <span class="p">:</span> <span class="s1">&#39;dest&#39;</span><span class="p">})</span>

        <span class="n">df_cb_final</span>  <span class="o">=</span> <span class="n">df_cb</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

        <span class="n">df_cb_final</span> <span class="o">=</span> <span class="n">df_cb_final</span><span class="p">[[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;dest&quot;</span><span class="p">,</span> <span class="s2">&quot;poe&quot;</span><span class="p">,</span> <span class="s2">&quot;mgra_entry&quot;</span><span class="p">,</span> <span class="s2">&quot;mgra_return&quot;</span><span class="p">,</span> <span class="s2">&quot;poe_taz&quot;</span><span class="p">]]</span>
        <span class="n">df_cb_final</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;uec&quot;</span><span class="p">,</span> <span class="s2">&quot;CrossBorderDestinationChoiceSoaAlternatives.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;CrossBorderDestinationChoiceSoaAlternatives.csv&quot;</span><span class="p">)</span>

    <span class="c1"># aggregating households.csv</span>
    <span class="k">if</span> <span class="s2">&quot;households.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - households.csv&quot;</span><span class="p">)</span>
        <span class="n">df_hh</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;households.csv&quot;</span><span class="p">))</span>
        <span class="n">df_hh</span><span class="p">[</span><span class="s2">&quot;mgra&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_hh</span><span class="p">[</span><span class="s2">&quot;mgra&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>
        <span class="n">df_hh</span><span class="p">[</span><span class="s2">&quot;taz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_hh</span><span class="p">[</span><span class="s2">&quot;taz&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>

        <span class="n">df_hh</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;households.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;households.csv&quot;</span><span class="p">)</span>

    <span class="c1"># aggregating ShadowPricingOutput_school_9.csv</span>
    <span class="k">if</span> <span class="s2">&quot;ShadowPricingOutput_school_9.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - ShadowPricingOutput_school_9.csv&quot;</span><span class="p">)</span>
        <span class="n">df_sp_sch</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;ShadowPricingOutput_school_9.csv&quot;</span><span class="p">))</span>

        <span class="n">agg_instructions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_sp_sch</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;size&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                <span class="n">agg_instructions</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">})</span>

            <span class="k">if</span> <span class="s2">&quot;shadowPrices&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                <span class="n">agg_instructions</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="s2">&quot;max&quot;</span><span class="p">})</span>

            <span class="k">if</span> <span class="s2">&quot;_origins&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                <span class="n">agg_instructions</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">})</span>

            <span class="k">if</span> <span class="s2">&quot;_modeledDests&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                <span class="n">agg_instructions</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">})</span>

        <span class="n">df_sp_sch</span><span class="p">[</span><span class="s1">&#39;mgra&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_sp_sch</span><span class="p">[</span><span class="s1">&#39;mgra&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>
        <span class="n">df_sp_sch_agg</span> <span class="o">=</span> <span class="n">df_sp_sch</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;mgra&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_instructions</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="n">alt</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_sp_sch_agg</span><span class="p">[</span><span class="s1">&#39;mgra&#39;</span><span class="p">])</span>
        <span class="n">df_sp_sch_agg</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s2">&quot;alt&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">alt</span><span class="p">)</span>
        <span class="n">df_sp_sch_agg</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df_sp_agg</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">df_sp_sch_agg</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;ShadowPricingOutput_school_9.csv&quot;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;ShadowPricingOutput_school_9.csv&quot;</span><span class="p">)</span>

    <span class="c1"># aggregating ShadowPricingOutput_work_9.csv</span>
    <span class="k">if</span> <span class="s2">&quot;ShadowPricingOutput_work_9.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - ShadowPricingOutput_work_9.csv&quot;</span><span class="p">)</span>
        <span class="n">df_sp_wrk</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;ShadowPricingOutput_work_9.csv&quot;</span><span class="p">))</span>

        <span class="n">agg_instructions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_sp_wrk</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;size&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                <span class="n">agg_instructions</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">})</span>

            <span class="k">if</span> <span class="s2">&quot;shadowPrices&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                <span class="n">agg_instructions</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="s2">&quot;max&quot;</span><span class="p">})</span>

            <span class="k">if</span> <span class="s2">&quot;_origins&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                <span class="n">agg_instructions</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">})</span>

            <span class="k">if</span> <span class="s2">&quot;_modeledDests&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                <span class="n">agg_instructions</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">})</span>

        <span class="n">df_sp_wrk</span><span class="p">[</span><span class="s1">&#39;mgra&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_sp_wrk</span><span class="p">[</span><span class="s1">&#39;mgra&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>

        <span class="n">df_sp_wrk_agg</span> <span class="o">=</span> <span class="n">df_sp_wrk</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;mgra&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_instructions</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="n">alt</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_sp_wrk_agg</span><span class="p">[</span><span class="s1">&#39;mgra&#39;</span><span class="p">])</span>
        <span class="n">df_sp_wrk_agg</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s2">&quot;alt&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">alt</span><span class="p">)</span>

        <span class="n">df_sp_wrk_agg</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df_sp_wrk_agg</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">df_sp_wrk_agg</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;ShadowPricingOutput_work_9.csv&quot;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;ShadowPricingOutput_work_9.csv&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;TourDcSoaDistanceAlts.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - TourDcSoaDistanceAlts.csv&quot;</span><span class="p">)</span>
        <span class="n">df_TourDcSoaDistanceAlts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;a&quot;</span> <span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">taz_zones</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;dest&quot;</span> <span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">taz_zones</span><span class="o">+</span><span class="mi">1</span><span class="p">)})</span>
        <span class="n">df_TourDcSoaDistanceAlts</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;uec&quot;</span><span class="p">,</span> <span class="s2">&quot;TourDcSoaDistanceAlts.csv&quot;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;DestinationChoiceAlternatives.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - DestinationChoiceAlternatives.csv&quot;</span><span class="p">)</span>
        <span class="n">df_DestinationChoiceAlternatives</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;a&quot;</span> <span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">mgra_zones</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;mgra&quot;</span> <span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mgra_zones</span><span class="o">+</span><span class="mi">1</span><span class="p">)})</span>
        <span class="n">df_DestinationChoiceAlternatives</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;uec&quot;</span><span class="p">,</span> <span class="s2">&quot;DestinationChoiceAlternatives.csv&quot;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;SoaTazDistAlts.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - SoaTazDistAlts.csv&quot;</span><span class="p">)</span>
        <span class="n">df_SoaTazDistAlts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;a&quot;</span> <span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">taz_zones</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;dest&quot;</span> <span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">taz_zones</span><span class="o">+</span><span class="mi">1</span><span class="p">)})</span>
        <span class="n">df_SoaTazDistAlts</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;uec&quot;</span><span class="p">,</span> <span class="s2">&quot;SoaTazDistAlts.csv&quot;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;TripMatrices.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - TripMatrices.csv&quot;</span><span class="p">)</span>
        <span class="n">trips</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span><span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;TripMatrices.csv&quot;</span><span class="p">))</span>
        <span class="n">trips</span><span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trips</span><span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>
        <span class="n">trips</span><span class="p">[</span><span class="s1">&#39;j&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trips</span><span class="p">[</span><span class="s1">&#39;j&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>

        <span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">trips</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">)</span>
        <span class="n">cols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;j&quot;</span><span class="p">)</span>

        <span class="n">trips_df</span> <span class="o">=</span> <span class="n">trips</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;j&#39;</span><span class="p">])[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">trips_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;TripMatrices.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;TripMatrices.csv&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;transponderModelAccessibilities.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - transponderModelAccessibilities.csv&quot;</span><span class="p">)</span>
        <span class="n">tran_access</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;transponderModelAccessibilities.csv&quot;</span><span class="p">))</span>
        <span class="n">tran_access</span><span class="p">[</span><span class="s1">&#39;TAZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tran_access</span><span class="p">[</span><span class="s1">&#39;TAZ&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>

        <span class="n">tran_access_agg</span> <span class="o">=</span> <span class="n">tran_access</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;TAZ&#39;</span><span class="p">])[</span><span class="s1">&#39;DIST&#39;</span><span class="p">,</span><span class="s1">&#39;AVGTTS&#39;</span><span class="p">,</span><span class="s1">&#39;PCTDETOUR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">tran_access_agg</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span><span class="s2">&quot;transponderModelAccessibilities.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;transponderModelAccessibilities.csv&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;crossBorderTours.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - crossBorderTours.csv&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;crossBorderTours.csv&quot;</span><span class="p">))</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originMGRA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originMGRA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationMGRA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationMGRA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>

        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originTAZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originTAZ&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationTAZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationTAZ&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;crossBorderTours.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;crossBorderTours.csv&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;crossBorderTrips.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - crossBorderTrips.csv&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;crossBorderTrips.csv&quot;</span><span class="p">))</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originMGRA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originMGRA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationMGRA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationMGRA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>

        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originTAZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originTAZ&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationTAZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationTAZ&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;crossBorderTrips.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;crossBorderTrips.csv&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;internalExternalTrips.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - internalExternalTrips.csv&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;internalExternalTrips.csv&quot;</span><span class="p">))</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originMGRA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originMGRA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationMGRA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationMGRA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>

        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originTAZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originTAZ&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationTAZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationTAZ&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;internalExternalTrips.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;internalExternalTrips.csv&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;visitorTours.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - visitorTours.csv&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;visitorTours.csv&quot;</span><span class="p">))</span>

        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originMGRA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originMGRA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationMGRA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationMGRA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;visitorTours.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;visitorTours.csv&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;visitorTrips.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - visitorTrips.csv&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;visitorTrips.csv&quot;</span><span class="p">))</span>

        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originMGRA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originMGRA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationMGRA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationMGRA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;visitorTrips.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;visitorTrips.csv&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;householdAVTrips.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - householdAVTrips.csv&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;householdAVTrips.csv&quot;</span><span class="p">))</span>
        <span class="c1">#print(os.path.join(model_dir, &quot;output&quot;, &quot;householdAVTrips.csv&quot;))</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;orig_mgra&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;orig_mgra&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;dest_gra&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;dest_gra&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>

        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;trip_orig_mgra&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;trip_orig_mgra&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;trip_dest_mgra&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;trip_dest_mgra&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;householdAVTrips.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;householdAVTrips.csv&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;airport_out.CBX.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - airport_out.CBX.csv&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;airport_out.CBX.csv&quot;</span><span class="p">))</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originMGRA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originMGRA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationMGRA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationMGRA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>

        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originTAZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originTAZ&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationTAZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationTAZ&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;airport_out.CBX.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;airport_out.CBX.csv&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;airport_out.SAN.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - airport_out.SAN.csv&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;airport_out.SAN.csv&quot;</span><span class="p">))</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originMGRA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originMGRA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationMGRA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationMGRA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>

        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originTAZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originTAZ&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationTAZ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationTAZ&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;airport_out.SAN.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;airport_out.SAN.csv&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;TNCtrips.csv&quot;</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Aggregating - TNCtrips.csv&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;TNCtrips.csv&quot;</span><span class="p">))</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originMgra&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originMgra&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationMgra&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationMgra&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_cwk</span><span class="p">)</span>

        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originTaz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;originTaz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationTaz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;destinationTaz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;TNCtrips.csv&quot;</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;TNCtrips.csv&quot;</span><span class="p">)</span>

    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Trip&quot;</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span>
                <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">([</span><span class="s2">&quot;FA&quot;</span><span class="p">,</span> <span class="s2">&quot;GO&quot;</span><span class="p">,</span> <span class="s2">&quot;IN&quot;</span><span class="p">,</span> <span class="s2">&quot;RE&quot;</span><span class="p">,</span> <span class="s2">&quot;SV&quot;</span><span class="p">,</span> <span class="s2">&quot;TH&quot;</span><span class="p">,</span> <span class="s2">&quot;WH&quot;</span><span class="p">],</span>
                                   <span class="p">[</span><span class="s2">&quot;OE&quot;</span><span class="p">,</span> <span class="s2">&quot;AM&quot;</span><span class="p">,</span> <span class="s2">&quot;MD&quot;</span><span class="p">,</span> <span class="s2">&quot;PM&quot;</span><span class="p">,</span> <span class="s2">&quot;OL&quot;</span><span class="p">])]</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Aggregating - </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">))</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;HomeZone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;HomeZone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rsm_dir</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span><span class="n">file</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<a id="rsm.translate"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="rsm.translate.copy_transit_demand" class="doc doc-heading">
          <code class="codehilite language-python"><span class="n">copy_transit_demand</span><span class="p">(</span><span class="n">matrix_names</span><span class="p">,</span> <span class="n">input_dir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span></code>

<a href="#rsm.translate.copy_transit_demand" class="headerlink" title="Permanent link"> ¶</a></h2>


  <div class="doc doc-contents ">
  
      <p>copies the omx transit demand matrix to rsm directory</p>
<h4 id="rsm.translate.copy_transit_demand--parameters">Parameters<a class="headerlink" href="#rsm.translate.copy_transit_demand--parameters" title="Permanent link"> ¶</a></h4>
<p>matrix_names : matrix_names (list)
    omx matrix filenames to aggregate
input_dir : input_dir (Path-like) 
    default &ldquo;.&rdquo;
output_dir : output_dir (Path-like)
    default &ldquo;.&rdquo;</p>
<h4 id="rsm.translate.copy_transit_demand--returns">Returns<a class="headerlink" href="#rsm.translate.copy_transit_demand--returns" title="Permanent link"> ¶</a></h4>

          <details class="quote">
            <summary>Source code in <code>rsm/translate.py</code></summary>
            <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">copy_transit_demand</span><span class="p">(</span>
    <span class="n">matrix_names</span><span class="p">,</span>
    <span class="n">input_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    copies the omx transit demand matrix to rsm directory</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    matrix_names : matrix_names (list)</span>
<span class="sd">        omx matrix filenames to aggregate</span>
<span class="sd">    input_dir : input_dir (Path-like) </span>
<span class="sd">        default &quot;.&quot;</span>
<span class="sd">    output_dir : output_dir (Path-like)</span>
<span class="sd">        default &quot;.&quot;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">for</span> <span class="n">mat_name</span> <span class="ow">in</span> <span class="n">matrix_names</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;.omx&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mat_name</span><span class="p">:</span>
            <span class="n">mat_name</span> <span class="o">=</span> <span class="n">mat_name</span> <span class="o">+</span> <span class="s2">&quot;.omx&quot;</span>

        <span class="n">input_file_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="n">mat_name</span><span class="p">)</span>
        <span class="n">output_file_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">mat_name</span><span class="p">)</span>

        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">input_file_dir</span><span class="p">,</span> <span class="n">output_file_dir</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="rsm.translate.translate_emmebank_demand" class="doc doc-heading">
          <code class="codehilite language-python"><span class="n">translate_emmebank_demand</span><span class="p">(</span><span class="n">input_databank</span><span class="p">,</span> <span class="n">output_databank</span><span class="p">,</span> <span class="n">cores_to_aggregate</span><span class="p">,</span> <span class="n">agg_zone_mapping</span><span class="p">)</span></code>

<a href="#rsm.translate.translate_emmebank_demand" class="headerlink" title="Permanent link"> ¶</a></h2>


  <div class="doc doc-contents ">
  
      <p>aggregates the demand matrix cores from one emme databank and loads them into another databank</p>
<h4 id="rsm.translate.translate_emmebank_demand--parameters">Parameters<a class="headerlink" href="#rsm.translate.translate_emmebank_demand--parameters" title="Permanent link"> ¶</a></h4>
<p>input_databank : input_databank (Emme databank)
    Emme databank
output_databank : output_databank (Emme databank)
    Emme databank
cores_to_aggregate : cores_to_aggregate (list)
    matrix corenames to aggregate
agg_zone_mapping: agg_zone_mapping (Path-like or pandas.DataFrame)
    zone number mapping between original and aggregated zones. 
    columns: original zones as &lsquo;taz&rsquo; and aggregated zones as &lsquo;cluster_id&rsquo;</p>
<h4 id="rsm.translate.translate_emmebank_demand--returns">Returns<a class="headerlink" href="#rsm.translate.translate_emmebank_demand--returns" title="Permanent link"> ¶</a></h4>
<p>None. Loads the trip matrices into emmebank.</p>

          <details class="quote">
            <summary>Source code in <code>rsm/translate.py</code></summary>
            <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">translate_emmebank_demand</span><span class="p">(</span>
    <span class="n">input_databank</span><span class="p">,</span>
    <span class="n">output_databank</span><span class="p">,</span>
    <span class="n">cores_to_aggregate</span><span class="p">,</span>
    <span class="n">agg_zone_mapping</span><span class="p">,</span>
<span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    aggregates the demand matrix cores from one emme databank and loads them into another databank</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    input_databank : input_databank (Emme databank)</span>
<span class="sd">        Emme databank</span>
<span class="sd">    output_databank : output_databank (Emme databank)</span>
<span class="sd">        Emme databank</span>
<span class="sd">    cores_to_aggregate : cores_to_aggregate (list)</span>
<span class="sd">        matrix corenames to aggregate</span>
<span class="sd">    agg_zone_mapping: agg_zone_mapping (Path-like or pandas.DataFrame)</span>
<span class="sd">        zone number mapping between original and aggregated zones. </span>
<span class="sd">        columns: original zones as &#39;taz&#39; and aggregated zones as &#39;cluster_id&#39;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None. Loads the trip matrices into emmebank.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">agg_zone_mapping_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">agg_zone_mapping</span><span class="p">))</span>
    <span class="n">agg_zone_mapping_df</span> <span class="o">=</span> <span class="n">agg_zone_mapping_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;taz&#39;</span><span class="p">)</span>

    <span class="n">agg_zone_mapping_df</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span> <span class="n">agg_zone_mapping_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">zone_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">agg_zone_mapping_df</span><span class="p">[</span><span class="s1">&#39;taz&#39;</span><span class="p">],</span> <span class="n">agg_zone_mapping_df</span><span class="p">[</span><span class="s1">&#39;cluster_id&#39;</span><span class="p">]))</span>

    <span class="k">for</span> <span class="n">core</span> <span class="ow">in</span> <span class="n">cores_to_aggregate</span><span class="p">:</span> 
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">input_databank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">core</span><span class="p">)</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
        <span class="n">matrix_array</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

        <span class="n">matrix_agg</span> <span class="o">=</span> <span class="n">_aggregate_matrix</span><span class="p">(</span><span class="n">matrix_array</span><span class="p">,</span> <span class="n">zone_mapping</span><span class="p">)</span>

        <span class="n">output_matrix</span> <span class="o">=</span> <span class="n">output_databank</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">core</span><span class="p">)</span>
        <span class="n">output_matrix</span><span class="o">.</span><span class="n">set_numpy_data</span><span class="p">(</span><span class="n">matrix_agg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="rsm.translate.translate_omx_demand" class="doc doc-heading">
          <code class="codehilite language-python"><span class="n">translate_omx_demand</span><span class="p">(</span><span class="n">matrix_names</span><span class="p">,</span> <span class="n">agg_zone_mapping</span><span class="p">,</span> <span class="n">input_dir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span></code>

<a href="#rsm.translate.translate_omx_demand" class="headerlink" title="Permanent link"> ¶</a></h2>


  <div class="doc doc-contents ">
  
      <p>aggregates the omx demand matrix to aggregated zone system</p>
<h4 id="rsm.translate.translate_omx_demand--parameters">Parameters<a class="headerlink" href="#rsm.translate.translate_omx_demand--parameters" title="Permanent link"> ¶</a></h4>
<p>matrix_names : matrix_names (list)
    omx matrix filenames to aggregate
agg_zone_mapping: agg_zone_mapping (path_like or pandas.DataFrame)
    zone number mapping between original and aggregated zones. 
    columns: original zones as &lsquo;taz&rsquo; and aggregated zones as &lsquo;cluster_id&rsquo;
input_dir : input_dir (path_like)
    default &ldquo;.&rdquo;
output_dir : output_dir (path_like) 
    default &ldquo;.&rdquo;</p>
<h4 id="rsm.translate.translate_omx_demand--returns">Returns<a class="headerlink" href="#rsm.translate.translate_omx_demand--returns" title="Permanent link"> ¶</a></h4>

          <details class="quote">
            <summary>Source code in <code>rsm/translate.py</code></summary>
            <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">translate_omx_demand</span><span class="p">(</span>
    <span class="n">matrix_names</span><span class="p">,</span>
    <span class="n">agg_zone_mapping</span><span class="p">,</span>
    <span class="n">input_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span>
<span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    aggregates the omx demand matrix to aggregated zone system</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    matrix_names : matrix_names (list)</span>
<span class="sd">        omx matrix filenames to aggregate</span>
<span class="sd">    agg_zone_mapping: agg_zone_mapping (path_like or pandas.DataFrame)</span>
<span class="sd">        zone number mapping between original and aggregated zones. </span>
<span class="sd">        columns: original zones as &#39;taz&#39; and aggregated zones as &#39;cluster_id&#39;</span>
<span class="sd">    input_dir : input_dir (path_like)</span>
<span class="sd">        default &quot;.&quot;</span>
<span class="sd">    output_dir : output_dir (path_like) </span>
<span class="sd">        default &quot;.&quot;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">agg_zone_mapping_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">agg_zone_mapping</span><span class="p">))</span>
    <span class="n">agg_zone_mapping_df</span> <span class="o">=</span> <span class="n">agg_zone_mapping_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;taz&#39;</span><span class="p">)</span>

    <span class="n">agg_zone_mapping_df</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span> <span class="n">agg_zone_mapping_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">zone_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">agg_zone_mapping_df</span><span class="p">[</span><span class="s1">&#39;taz&#39;</span><span class="p">],</span> <span class="n">agg_zone_mapping_df</span><span class="p">[</span><span class="s1">&#39;cluster_id&#39;</span><span class="p">]))</span>
    <span class="n">agg_zones</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">agg_zone_mapping_df</span><span class="p">[</span><span class="s1">&#39;cluster_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

    <span class="k">for</span> <span class="n">mat_name</span> <span class="ow">in</span> <span class="n">matrix_names</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;.omx&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mat_name</span><span class="p">:</span>
            <span class="n">mat_name</span> <span class="o">=</span> <span class="n">mat_name</span> <span class="o">+</span> <span class="s2">&quot;.omx&quot;</span>

        <span class="c1">#logger.info(&quot;Aggregating Matrix: &quot; + mat_name + &quot; ...&quot;)</span>

        <span class="n">input_skim_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="n">mat_name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">input_skim_file</span><span class="p">)</span>
        <span class="n">output_skim_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">mat_name</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">input_skim_file</span><span class="p">)</span>

        <span class="n">input_matrix</span> <span class="o">=</span> <span class="n">omx</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">input_skim_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> 
        <span class="n">input_mapping_name</span> <span class="o">=</span> <span class="n">input_matrix</span><span class="o">.</span><span class="n">list_mappings</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">input_cores</span> <span class="o">=</span> <span class="n">input_matrix</span><span class="o">.</span><span class="n">list_matrices</span><span class="p">()</span>

        <span class="n">output_matrix</span> <span class="o">=</span> <span class="n">omx</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">output_skim_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">core</span> <span class="ow">in</span> <span class="n">input_cores</span><span class="p">:</span>
            <span class="n">matrix</span> <span class="o">=</span> <span class="n">input_matrix</span><span class="p">[</span><span class="n">core</span><span class="p">]</span>
            <span class="n">matrix_array</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">matrix_agg</span> <span class="o">=</span> <span class="n">_aggregate_matrix</span><span class="p">(</span><span class="n">matrix_array</span><span class="p">,</span> <span class="n">zone_mapping</span><span class="p">)</span>
            <span class="n">output_matrix</span><span class="p">[</span><span class="n">core</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrix_agg</span>

        <span class="n">output_matrix</span><span class="o">.</span><span class="n">create_mapping</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">input_mapping_name</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="n">agg_zones</span><span class="p">)</span>

        <span class="n">input_matrix</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">output_matrix</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<a id="rsm.sampler"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="rsm.sampler.rsm_household_sampler" class="doc doc-heading">
          <code class="codehilite language-python"><span class="n">rsm_household_sampler</span><span class="p">(</span><span class="n">input_dir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">prev_iter_access</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">curr_iter_access</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">study_area</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">input_household</span><span class="o">=</span><span class="s1">&#39;households.csv&#39;</span><span class="p">,</span> <span class="n">input_person</span><span class="o">=</span><span class="s1">&#39;persons.csv&#39;</span><span class="p">,</span> <span class="n">taz_crosswalk</span><span class="o">=</span><span class="s1">&#39;taz_crosswalk.csv&#39;</span><span class="p">,</span> <span class="n">mgra_crosswalk</span><span class="o">=</span><span class="s1">&#39;mgra_crosswalk.csv&#39;</span><span class="p">,</span> <span class="n">compare_access_columns</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;NONMAN_AUTO&#39;</span><span class="p">,</span> <span class="s1">&#39;NONMAN_TRANSIT&#39;</span><span class="p">,</span> <span class="s1">&#39;NONMAN_NONMOTOR&#39;</span><span class="p">,</span> <span class="s1">&#39;NONMAN_SOV_0&#39;</span><span class="p">),</span> <span class="n">default_sampling_rate</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">lower_bound_sampling_rate</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">upper_bound_sampling_rate</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">output_household</span><span class="o">=</span><span class="s1">&#39;sampled_households.csv&#39;</span><span class="p">,</span> <span class="n">output_person</span><span class="o">=</span><span class="s1">&#39;sampled_person.csv&#39;</span><span class="p">)</span></code>

<a href="#rsm.sampler.rsm_household_sampler" class="headerlink" title="Permanent link"> ¶</a></h2>


  <div class="doc doc-contents ">
  
      <p>Take an intelligent sampling of households.</p>
<h4 id="rsm.sampler.rsm_household_sampler--parameters">Parameters<a class="headerlink" href="#rsm.sampler.rsm_household_sampler--parameters" title="Permanent link"> ¶</a></h4>
<p>input_dir : input_dir (path_like)
    default &ldquo;.&rdquo;
output_dir : output_dir (path_like)
    default &ldquo;.&rdquo;
prev_iter_access : prev_iter_access (Path-like or pandas.DataFrame)
    Accessibility in an old (default, no treatment, etc) run is given (preloaded)
    or read in from here. Give as a relative path (from <code>input_dir</code>) or an
    absolute path.
curr_iter_access : curr_iter_access (Path-like or pandas.DataFrame)
    Accessibility in the latest run is given (preloaded) or read in from here.
    Give as a relative path (from <code>input_dir</code>) or an absolute path.
study_area : study_area (array-like)
    Array of RSM zone (these are numbered 1 to N in the RSM) in the study area.
    These zones are sampled at 100% if differential sampling is also turned on.
input_household : input_household (Path-like or pandas.DataFrame)
    Complete synthetic household file.  This data will be filtered to match the
    sampling of households and written out to a new CSV file.
input_person : input_person (Path-like or pandas.DataFrame)
    Complete synthetic persons file.  This data will be filtered to match the
    sampling of households and written out to a new CSV file.
compare_access_columns : compare_access_columns (Collection[str])
    Column names in the accessibility file to use for comparing accessibility.
    Only changes in the values in these columns will be evaluated.
default_sampling_rate : default_sampling_rate (float)
    The default sampling rate, in the range (0,1]
lower_bound_sampling_rate : lower_bound_sampling_rate (float)
    Sampling rates by zone will be truncated so they are never lower than this.
upper_bound_sampling_rate : upper_bound_sampling_rate (float)
    Sampling rates by zone will be truncated so they are never higher than this.</p>
<h4 id="rsm.sampler.rsm_household_sampler--returns">Returns<a class="headerlink" href="#rsm.sampler.rsm_household_sampler--returns" title="Permanent link"> ¶</a></h4>
<p>sample_households_df, sample_persons_df : sample_households_df, sample_persons_df (pandas.DataFrame)
    These are the sampled population to resimulate.  They are also written to
    the output_dir</p>

          <details class="quote">
            <summary>Source code in <code>rsm/sampler.py</code></summary>
            <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rsm_household_sampler</span><span class="p">(</span>
    <span class="n">input_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="n">prev_iter_access</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">curr_iter_access</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">study_area</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">input_household</span><span class="o">=</span><span class="s2">&quot;households.csv&quot;</span><span class="p">,</span>
    <span class="n">input_person</span><span class="o">=</span><span class="s2">&quot;persons.csv&quot;</span><span class="p">,</span>
    <span class="n">taz_crosswalk</span><span class="o">=</span><span class="s2">&quot;taz_crosswalk.csv&quot;</span><span class="p">,</span>
    <span class="n">mgra_crosswalk</span><span class="o">=</span><span class="s2">&quot;mgra_crosswalk.csv&quot;</span><span class="p">,</span>
    <span class="n">compare_access_columns</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;NONMAN_AUTO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NONMAN_TRANSIT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NONMAN_NONMOTOR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NONMAN_SOV_0&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">default_sampling_rate</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>  <span class="c1"># fix the values of this after some testing</span>
    <span class="n">lower_bound_sampling_rate</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>  <span class="c1"># fix the values of this after some testing</span>
    <span class="n">upper_bound_sampling_rate</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># fix the values of this after some testing</span>
    <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">output_household</span><span class="o">=</span><span class="s2">&quot;sampled_households.csv&quot;</span><span class="p">,</span>
    <span class="n">output_person</span><span class="o">=</span><span class="s2">&quot;sampled_person.csv&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Take an intelligent sampling of households.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    input_dir : input_dir (path_like)</span>
<span class="sd">        default &quot;.&quot;</span>
<span class="sd">    output_dir : output_dir (path_like)</span>
<span class="sd">        default &quot;.&quot;</span>
<span class="sd">    prev_iter_access : prev_iter_access (Path-like or pandas.DataFrame)</span>
<span class="sd">        Accessibility in an old (default, no treatment, etc) run is given (preloaded)</span>
<span class="sd">        or read in from here. Give as a relative path (from `input_dir`) or an</span>
<span class="sd">        absolute path.</span>
<span class="sd">    curr_iter_access : curr_iter_access (Path-like or pandas.DataFrame)</span>
<span class="sd">        Accessibility in the latest run is given (preloaded) or read in from here.</span>
<span class="sd">        Give as a relative path (from `input_dir`) or an absolute path.</span>
<span class="sd">    study_area : study_area (array-like)</span>
<span class="sd">        Array of RSM zone (these are numbered 1 to N in the RSM) in the study area.</span>
<span class="sd">        These zones are sampled at 100% if differential sampling is also turned on.</span>
<span class="sd">    input_household : input_household (Path-like or pandas.DataFrame)</span>
<span class="sd">        Complete synthetic household file.  This data will be filtered to match the</span>
<span class="sd">        sampling of households and written out to a new CSV file.</span>
<span class="sd">    input_person : input_person (Path-like or pandas.DataFrame)</span>
<span class="sd">        Complete synthetic persons file.  This data will be filtered to match the</span>
<span class="sd">        sampling of households and written out to a new CSV file.</span>
<span class="sd">    compare_access_columns : compare_access_columns (Collection[str])</span>
<span class="sd">        Column names in the accessibility file to use for comparing accessibility.</span>
<span class="sd">        Only changes in the values in these columns will be evaluated.</span>
<span class="sd">    default_sampling_rate : default_sampling_rate (float)</span>
<span class="sd">        The default sampling rate, in the range (0,1]</span>
<span class="sd">    lower_bound_sampling_rate : lower_bound_sampling_rate (float)</span>
<span class="sd">        Sampling rates by zone will be truncated so they are never lower than this.</span>
<span class="sd">    upper_bound_sampling_rate : upper_bound_sampling_rate (float)</span>
<span class="sd">        Sampling rates by zone will be truncated so they are never higher than this.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sample_households_df, sample_persons_df : sample_households_df, sample_persons_df (pandas.DataFrame)</span>
<span class="sd">        These are the sampled population to resimulate.  They are also written to</span>
<span class="sd">        the output_dir</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">input_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dir</span> <span class="ow">or</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
    <span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span> <span class="ow">or</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;CALL rsm_household_sampler&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">input_dir</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">output_dir</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_resolve_df</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">make_index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
            <span class="c1"># read in the file to a pandas DataFrame</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span> <span class="ow">or</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">elif</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;must be path-like or DataFrame&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">make_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">make_index</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">columns</span>
        <span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">make_index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_resolve_out_filename</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="n">prev_iter_access_df</span> <span class="o">=</span> <span class="n">_resolve_df</span><span class="p">(</span>
        <span class="n">prev_iter_access</span><span class="p">,</span> <span class="n">input_dir</span><span class="p">,</span> <span class="n">make_index</span><span class="o">=</span><span class="s2">&quot;MGRA&quot;</span>
    <span class="p">)</span>
    <span class="n">curr_iter_access_df</span> <span class="o">=</span> <span class="n">_resolve_df</span><span class="p">(</span>
        <span class="n">curr_iter_access</span><span class="p">,</span> <span class="n">input_dir</span><span class="p">,</span> <span class="n">make_index</span><span class="o">=</span><span class="s2">&quot;MGRA&quot;</span>
    <span class="p">)</span>
    <span class="n">rsm_zones</span> <span class="o">=</span> <span class="n">_resolve_df</span><span class="p">(</span><span class="n">taz_crosswalk</span><span class="p">,</span> <span class="n">input_dir</span><span class="p">)</span>
    <span class="n">dict_clusters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rsm_zones</span><span class="p">[</span><span class="s2">&quot;taz&quot;</span><span class="p">],</span> <span class="n">rsm_zones</span><span class="p">[</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">]))</span>

    <span class="n">rsm_mgra_zones</span> <span class="o">=</span> <span class="n">_resolve_df</span><span class="p">(</span><span class="n">mgra_crosswalk</span><span class="p">,</span> <span class="n">input_dir</span><span class="p">)</span>
    <span class="n">rsm_mgra_zones</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">rsm_mgra_zones</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">dict_clusters_mgra</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rsm_mgra_zones</span><span class="p">[</span><span class="s2">&quot;mgra&quot;</span><span class="p">],</span> <span class="n">rsm_mgra_zones</span><span class="p">[</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">]))</span>

    <span class="c1"># changing the taz and mgra to new cluster ids</span>
    <span class="n">input_household_df</span> <span class="o">=</span> <span class="n">_resolve_df</span><span class="p">(</span><span class="n">input_household</span><span class="p">,</span> <span class="n">input_dir</span><span class="p">)</span>
    <span class="n">input_household_df</span><span class="p">[</span><span class="s2">&quot;taz&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_household_df</span><span class="p">[</span><span class="s2">&quot;taz&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters</span><span class="p">)</span>
    <span class="n">input_household_df</span><span class="p">[</span><span class="s2">&quot;mgra&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_household_df</span><span class="p">[</span><span class="s2">&quot;mgra&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dict_clusters_mgra</span><span class="p">)</span>
    <span class="n">input_household_df</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">mgra_hh</span> <span class="o">=</span> <span class="n">input_household_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;mgra&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;n_hh&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">curr_iter_access_df</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">prev_iter_access_df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">curr_iter_access_df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;missing curr_iter_access_df from </span><span class="si">{</span><span class="n">curr_iter_access</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prev_iter_access_df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;missing prev_iter_access_df from </span><span class="si">{</span><span class="n">prev_iter_access</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># true when sampler is turned off. default_sampling_rate should be set to 1</span>

        <span class="n">mgra_hh</span><span class="p">[</span><span class="s2">&quot;sampling_rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_sampling_rate</span>
        <span class="k">if</span> <span class="n">study_area</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mgra_hh</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mgra_hh</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">study_area</span><span class="p">),</span> <span class="s2">&quot;sampling_rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">sample_households</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">mgra_id</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">mgra_hh</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">input_household_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">input_household_df</span><span class="p">[</span><span class="s2">&quot;mgra&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">mgra_id</span><span class="p">]</span>
            <span class="n">sampling_rate</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sampling_rate&quot;</span><span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sampling rate of RSM zone </span><span class="si">{</span><span class="n">mgra_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">sampling_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="n">sampling_rate</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">mgra_id</span> <span class="o">+</span> <span class="n">random_seed</span><span class="p">)</span>
            <span class="n">sample_households</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># combine study are and non-study area households into single dataframe</span>
        <span class="n">sample_households_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">sample_households</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># restrict to rows only where TAZs have households</span>
        <span class="n">prev_iter_access_df</span> <span class="o">=</span> <span class="n">prev_iter_access_df</span><span class="p">[</span>
            <span class="n">prev_iter_access_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">mgra_hh</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">curr_iter_access_df</span> <span class="o">=</span> <span class="n">curr_iter_access_df</span><span class="p">[</span>
            <span class="n">curr_iter_access_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">mgra_hh</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># compare accessibility columns</span>
        <span class="n">compare_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">compare_access_columns</span><span class="p">:</span>
            <span class="n">compare_results</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">curr_iter_access_df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev_iter_access_df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>  <span class="c1"># take absolute difference</span>
        <span class="n">compare_results</span><span class="p">[</span><span class="s2">&quot;MGRA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prev_iter_access_df</span><span class="o">.</span><span class="n">index</span>

        <span class="n">compare_results</span> <span class="o">=</span> <span class="n">compare_results</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;MGRA&quot;</span><span class="p">)</span>

        <span class="c1"># Take row sums of all difference</span>
        <span class="n">compare_results</span><span class="p">[</span><span class="s2">&quot;Total&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compare_results</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">compare_access_columns</span><span class="p">)]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>

        <span class="c1"># TODO: potentially adjust this later after we figure out a better approach</span>
        <span class="n">wgts</span> <span class="o">=</span> <span class="n">compare_results</span><span class="p">[</span><span class="s2">&quot;Total&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.01</span>
        <span class="n">wgts</span> <span class="o">/=</span> <span class="n">wgts</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">/</span> <span class="n">default_sampling_rate</span>
        <span class="n">compare_results</span><span class="p">[</span><span class="s2">&quot;sampling_rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
            <span class="n">wgts</span><span class="p">,</span> <span class="n">lower_bound_sampling_rate</span><span class="p">,</span> <span class="n">upper_bound_sampling_rate</span>
        <span class="p">)</span>

        <span class="n">sample_households</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sample_rate_df</span> <span class="o">=</span> <span class="n">compare_results</span><span class="p">[[</span><span class="s2">&quot;sampling_rate&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">study_area</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sample_rate_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="n">sample_rate_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">study_area</span><span class="p">),</span> <span class="s2">&quot;sampling_rate&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">mgra_id</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sample_rate_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">input_household_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">input_household_df</span><span class="p">[</span><span class="s2">&quot;mgra&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">mgra_id</span><span class="p">]</span>
            <span class="n">sampling_rate</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sampling_rate&quot;</span><span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sampling rate of RSM zone </span><span class="si">{</span><span class="n">mgra_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">sampling_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="n">sampling_rate</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">mgra_id</span> <span class="o">+</span> <span class="n">random_seed</span><span class="p">)</span>
            <span class="n">sample_households</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># combine study are and non-study area households into single dataframe</span>
        <span class="n">sample_households_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">sample_households</span><span class="p">)</span>

    <span class="n">sample_households_df</span> <span class="o">=</span> <span class="n">sample_households_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hhid&quot;</span><span class="p">])</span>
    <span class="n">sample_households_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">_resolve_out_filename</span><span class="p">(</span><span class="n">output_household</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># select persons belonging to sampled households</span>
    <span class="n">sample_hhids</span> <span class="o">=</span> <span class="n">sample_households_df</span><span class="p">[</span><span class="s2">&quot;hhid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="n">persons_df</span> <span class="o">=</span> <span class="n">_resolve_df</span><span class="p">(</span><span class="n">input_person</span><span class="p">,</span> <span class="n">input_dir</span><span class="p">)</span>
    <span class="n">sample_persons_df</span> <span class="o">=</span> <span class="n">persons_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">persons_df</span><span class="p">[</span><span class="s2">&quot;hhid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">sample_hhids</span><span class="p">)]</span>
    <span class="n">sample_persons_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">_resolve_out_filename</span><span class="p">(</span><span class="n">output_person</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">global_sample_rate</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_households_df</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_household_df</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Sampling Rate : </span><span class="si">{</span><span class="n">global_sample_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sample_households_df</span><span class="p">,</span> <span class="n">sample_persons_df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<a id="rsm.assembler"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="rsm.assembler.rsm_assemble" class="doc doc-heading">
          <code class="codehilite language-python"><span class="n">rsm_assemble</span><span class="p">(</span><span class="n">orig_indiv</span><span class="p">,</span> <span class="n">orig_joint</span><span class="p">,</span> <span class="n">rsm_indiv</span><span class="p">,</span> <span class="n">rsm_joint</span><span class="p">,</span> <span class="n">households</span><span class="p">,</span> <span class="n">mgra_crosswalk</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">taz_crosswalk</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sample_rate</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">study_area_taz</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">run_assembler</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#rsm.assembler.rsm_assemble" class="headerlink" title="Permanent link"> ¶</a></h2>


  <div class="doc doc-contents ">
  
      <p>Assemble and evaluate RSM trip making.</p>
<h4 id="rsm.assembler.rsm_assemble--parameters">Parameters<a class="headerlink" href="#rsm.assembler.rsm_assemble--parameters" title="Permanent link"> ¶</a></h4>
<p>orig_indiv : orig_indiv (path_like)
    Trips table from &ldquo;original&rdquo; model run, should be comprehensive simulation
    of all individual trips for all synthetic households.
orig_joint : orig_joint (path_like)
    Joint trips table from &ldquo;original&rdquo; model run, should be comprehensive simulation
    of all joint trips for all synthetic households.
rsm_indiv : rsm_indiv (path_like)
    Trips table from RSM model run, should be a simulation of all individual
    trips for potentially only a subset of all synthetic households.
rsm_joint : rsm_joint (path_like)
    Trips table from RSM model run, should be a simulation of all joint
    trips for potentially only a subset of all synthetic households (the
    same sampled households as in <code>rsm_indiv</code>).
households : households (path_like)
    Synthetic household file, used to get home zones for households.
mgra_crosswalk : mgra_crosswalk (path_like, optional)
    Crosswalk from original MGRA to clustered zone ids.  Provide this crosswalk
    if the <code>orig_indiv</code> and <code>orig_joint</code> files reference the original MGRA system
    and those id&rsquo;s need to be converted to aggregated values before merging.
sample_rate : sample_rate (float)
    Default/fixed sample rate if sampler was turned off
    this is used to scale the trips if run_assembler is 0
run_assembler : run_assembler (boolean)
    Flag to indicate whether to run RSM assembler or not. 
    1 is to run assembler, 0 is to turn if off
    setting this to 0 is only an option if sampler is turned off     <br />
sample_rate : float
    default/fixed sample rate if sampler was turned off
    this is used to scale the trips if run_assembler is 0
study_area_rsm_zones :  list
    it is list of study area RSM zones</p>
<h4 id="rsm.assembler.rsm_assemble--returns">Returns<a class="headerlink" href="#rsm.assembler.rsm_assemble--returns" title="Permanent link"> ¶</a></h4>
<p>final_trips_rsm : final_ind_trips (pd.DataFrame)
    Assembled trip table for RSM run, filling in archived trip values for
    non-resimulated households.
combined_trips_by_zone : final_jnt_trips (pd.DataFrame)
    Summary table of changes in trips by mode, by household home zone.
    Used to check whether undersampled zones have stable travel behavior.</p>
<p>Separate tables for individual and joint trips, as required by java.</p>

          <details class="quote">
            <summary>Source code in <code>rsm/assembler.py</code></summary>
            <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rsm_assemble</span><span class="p">(</span>
    <span class="n">orig_indiv</span><span class="p">,</span>
    <span class="n">orig_joint</span><span class="p">,</span>
    <span class="n">rsm_indiv</span><span class="p">,</span>
    <span class="n">rsm_joint</span><span class="p">,</span>
    <span class="n">households</span><span class="p">,</span>
    <span class="n">mgra_crosswalk</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">taz_crosswalk</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">sample_rate</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="n">study_area_taz</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">run_assembler</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assemble and evaluate RSM trip making.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    orig_indiv : orig_indiv (path_like)</span>
<span class="sd">        Trips table from &quot;original&quot; model run, should be comprehensive simulation</span>
<span class="sd">        of all individual trips for all synthetic households.</span>
<span class="sd">    orig_joint : orig_joint (path_like)</span>
<span class="sd">        Joint trips table from &quot;original&quot; model run, should be comprehensive simulation</span>
<span class="sd">        of all joint trips for all synthetic households.</span>
<span class="sd">    rsm_indiv : rsm_indiv (path_like)</span>
<span class="sd">        Trips table from RSM model run, should be a simulation of all individual</span>
<span class="sd">        trips for potentially only a subset of all synthetic households.</span>
<span class="sd">    rsm_joint : rsm_joint (path_like)</span>
<span class="sd">        Trips table from RSM model run, should be a simulation of all joint</span>
<span class="sd">        trips for potentially only a subset of all synthetic households (the</span>
<span class="sd">        same sampled households as in `rsm_indiv`).</span>
<span class="sd">    households : households (path_like)</span>
<span class="sd">        Synthetic household file, used to get home zones for households.</span>
<span class="sd">    mgra_crosswalk : mgra_crosswalk (path_like, optional)</span>
<span class="sd">        Crosswalk from original MGRA to clustered zone ids.  Provide this crosswalk</span>
<span class="sd">        if the `orig_indiv` and `orig_joint` files reference the original MGRA system</span>
<span class="sd">        and those id&#39;s need to be converted to aggregated values before merging.</span>
<span class="sd">    sample_rate : sample_rate (float)</span>
<span class="sd">        Default/fixed sample rate if sampler was turned off</span>
<span class="sd">        this is used to scale the trips if run_assembler is 0</span>
<span class="sd">    run_assembler : run_assembler (boolean)</span>
<span class="sd">        Flag to indicate whether to run RSM assembler or not. </span>
<span class="sd">        1 is to run assembler, 0 is to turn if off</span>
<span class="sd">        setting this to 0 is only an option if sampler is turned off       </span>
<span class="sd">    sample_rate : float</span>
<span class="sd">        default/fixed sample rate if sampler was turned off</span>
<span class="sd">        this is used to scale the trips if run_assembler is 0</span>
<span class="sd">    study_area_rsm_zones :  list</span>
<span class="sd">        it is list of study area RSM zones</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    final_trips_rsm : final_ind_trips (pd.DataFrame)</span>
<span class="sd">        Assembled trip table for RSM run, filling in archived trip values for</span>
<span class="sd">        non-resimulated households.</span>
<span class="sd">    combined_trips_by_zone : final_jnt_trips (pd.DataFrame)</span>
<span class="sd">        Summary table of changes in trips by mode, by household home zone.</span>
<span class="sd">        Used to check whether undersampled zones have stable travel behavior.</span>

<span class="sd">    Separate tables for individual and joint trips, as required by java.</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">orig_indiv</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">orig_indiv</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
    <span class="n">orig_joint</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">orig_joint</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
    <span class="n">rsm_indiv</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">rsm_indiv</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
    <span class="n">rsm_joint</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">rsm_joint</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
    <span class="n">households</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">households</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>

    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">orig_indiv</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">orig_joint</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">rsm_indiv</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">rsm_joint</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">households</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mgra_crosswalk</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mgra_crosswalk</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">mgra_crosswalk</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">mgra_crosswalk</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">taz_crosswalk</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">taz_crosswalk</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">taz_crosswalk</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">taz_crosswalk</span><span class="p">)</span>

    <span class="c1"># load trip data - partial simulation of RSM model</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;reading ind_trips_rsm&quot;</span><span class="p">)</span>
    <span class="n">ind_trips_rsm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">rsm_indiv</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;reading jnt_trips_rsm&quot;</span><span class="p">)</span>
    <span class="n">jnt_trips_rsm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">rsm_joint</span><span class="p">)</span>

    <span class="n">scale_factor</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">sample_rate</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">run_assembler</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># load trip data - full simulation of residual/source model</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;reading ind_trips_full&quot;</span><span class="p">)</span>
        <span class="n">ind_trips_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">orig_indiv</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;reading jnt_trips_full&quot;</span><span class="p">)</span>
        <span class="n">jnt_trips_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">orig_joint</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mgra_crosswalk</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;applying mgra_crosswalk to original data&quot;</span><span class="p">)</span>
            <span class="n">mgra_crosswalk</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">mgra_crosswalk</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;MGRA&quot;</span><span class="p">)[</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">]</span>
            <span class="n">mgra_crosswalk</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">mgra_crosswalk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ind_trips_full</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_mgra&quot;</span><span class="p">)]:</span>
                <span class="n">ind_trips_full</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">ind_trips_full</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_crosswalk</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">jnt_trips_full</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_mgra&quot;</span><span class="p">)]:</span>
                <span class="n">jnt_trips_full</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">jnt_trips_full</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">mgra_crosswalk</span><span class="p">)</span>

        <span class="c1"># convert to rsm trips</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;convert to common table platform&quot;</span><span class="p">)</span>
        <span class="n">rsm_trips</span> <span class="o">=</span> <span class="n">_merge_joint_and_indiv_trips</span><span class="p">(</span><span class="n">ind_trips_rsm</span><span class="p">,</span> <span class="n">jnt_trips_rsm</span><span class="p">)</span>
        <span class="n">original_trips</span> <span class="o">=</span> <span class="n">_merge_joint_and_indiv_trips</span><span class="p">(</span><span class="n">ind_trips_full</span><span class="p">,</span> <span class="n">jnt_trips_full</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;get all hhids in trips produced by RSM&quot;</span><span class="p">)</span>
        <span class="n">hh_ids_rsm</span> <span class="o">=</span> <span class="n">rsm_trips</span><span class="p">[</span><span class="s2">&quot;hh_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;remove orginal model trips made by households chosen in RSM trips&quot;</span><span class="p">)</span>
        <span class="n">original_trips_not_resimulated</span> <span class="o">=</span> <span class="n">original_trips</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="o">~</span><span class="n">original_trips</span><span class="p">[</span><span class="s2">&quot;hh_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">hh_ids_rsm</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">original_ind_trips_not_resimulated</span> <span class="o">=</span> <span class="n">ind_trips_full</span><span class="p">[</span>
            <span class="o">~</span><span class="n">ind_trips_full</span><span class="p">[</span><span class="s2">&quot;hh_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">hh_ids_rsm</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">original_jnt_trips_not_resimulated</span> <span class="o">=</span> <span class="n">jnt_trips_full</span><span class="p">[</span>
            <span class="o">~</span><span class="n">jnt_trips_full</span><span class="p">[</span><span class="s2">&quot;hh_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">hh_ids_rsm</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;concatenate trips from rsm and original model&quot;</span><span class="p">)</span>
        <span class="n">final_trips_rsm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span><span class="n">rsm_trips</span><span class="p">,</span> <span class="n">original_trips_not_resimulated</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">final_ind_trips</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span><span class="n">ind_trips_rsm</span><span class="p">,</span> <span class="n">original_ind_trips_not_resimulated</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">final_jnt_trips</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span><span class="n">jnt_trips_rsm</span><span class="p">,</span> <span class="n">original_jnt_trips_not_resimulated</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Get percentage change in total trips by mode for each home zone</span>

        <span class="c1"># extract trips made by households in RSM and Original model</span>
        <span class="n">original_trips_that_were_resimulated</span> <span class="o">=</span> <span class="n">original_trips</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="n">original_trips</span><span class="p">[</span><span class="s2">&quot;hh_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">hh_ids_rsm</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">def</span> <span class="nf">_agg_by_hhid_and_tripmode</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;hh_id&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_mode&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># combining trips by hhid and trip mode</span>
        <span class="n">combined_trips</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">_agg_by_hhid_and_tripmode</span><span class="p">(</span><span class="n">original_trips_that_were_resimulated</span><span class="p">,</span> <span class="s2">&quot;n_trips_orig&quot;</span><span class="p">),</span>
            <span class="n">_agg_by_hhid_and_tripmode</span><span class="p">(</span><span class="n">rsm_trips</span><span class="p">,</span> <span class="s2">&quot;n_trips_rsm&quot;</span><span class="p">),</span>
            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hh_id&quot;</span><span class="p">,</span> <span class="s2">&quot;trip_mode&quot;</span><span class="p">],</span>
            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">,</span>
            <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># aggregating by Home zone</span>
        <span class="n">hh_rsm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">households</span><span class="p">)</span>
        <span class="n">hh_id_col_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hhid&quot;</span><span class="p">,</span> <span class="s2">&quot;hh_id&quot;</span><span class="p">,</span> <span class="s2">&quot;household_id&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">hhid</span> <span class="ow">in</span> <span class="n">hh_id_col_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hhid</span> <span class="ow">in</span> <span class="n">hh_rsm</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;none of </span><span class="si">{</span><span class="n">hh_id_col_names</span><span class="si">!r}</span><span class="s2"> in household file&quot;</span><span class="p">)</span>
        <span class="n">homezone_col_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mgra&quot;</span><span class="p">,</span> <span class="s2">&quot;home_mgra&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">zoneid</span> <span class="ow">in</span> <span class="n">homezone_col_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">zoneid</span> <span class="ow">in</span> <span class="n">hh_rsm</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;none of </span><span class="si">{</span><span class="n">homezone_col_names</span><span class="si">!r}</span><span class="s2"> in household file&quot;</span><span class="p">)</span>
        <span class="n">hh_rsm</span> <span class="o">=</span> <span class="n">hh_rsm</span><span class="p">[[</span><span class="n">hhid</span><span class="p">,</span> <span class="n">zoneid</span><span class="p">]]</span>

        <span class="c1"># attach home zone id</span>
        <span class="n">combined_trips</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
            <span class="n">combined_trips</span><span class="p">,</span> <span class="n">hh_rsm</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;hh_id&quot;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="n">hhid</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
        <span class="p">)</span>

        <span class="n">combined_trips_by_zone</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">combined_trips</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">zoneid</span><span class="p">,</span> <span class="s2">&quot;trip_mode&quot;</span><span class="p">])[[</span><span class="s2">&quot;n_trips_orig&quot;</span><span class="p">,</span> <span class="s2">&quot;n_trips_rsm&quot;</span><span class="p">]]</span>
            <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">combined_trips_by_zone</span> <span class="o">=</span> <span class="n">combined_trips_by_zone</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span>
            <span class="s2">&quot;net_change = (n_trips_rsm - n_trips_orig)&quot;</span>
        <span class="p">)</span>

        <span class="n">combined_trips_by_zone</span><span class="p">[</span><span class="s2">&quot;max_trips&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span>
            <span class="n">combined_trips_by_zone</span><span class="o">.</span><span class="n">n_trips_rsm</span><span class="p">,</span> <span class="n">combined_trips_by_zone</span><span class="o">.</span><span class="n">n_trips_orig</span>
        <span class="p">)</span>
        <span class="n">combined_trips_by_zone</span> <span class="o">=</span> <span class="n">combined_trips_by_zone</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span>
            <span class="s2">&quot;pct_change = net_change / max_trips * 100&quot;</span>
        <span class="p">)</span>
        <span class="n">combined_trips_by_zone</span> <span class="o">=</span> <span class="n">combined_trips_by_zone</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;max_trips&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># if assembler is set to be turned off</span>
        <span class="c1"># then scale the trips in the trip list using the fixed sample rate </span>
        <span class="c1"># trips in the final trip lists will be 100%</span>
        <span class="n">scale_factor</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">sample_rate</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">study_area_taz</span><span class="p">:</span>
            <span class="n">sa_rsm</span> <span class="o">=</span> <span class="n">study_area_taz</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sa_rsm</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># concat is slow</span>
        <span class="c1"># https://stackoverflow.com/questions/50788508/how-can-i-replicate-rows-of-a-pandas-dataframe</span>
        <span class="c1">#final_ind_trips = pd.concat([ind_trips_rsm]*scale_factor, ignore_index=True)</span>
        <span class="c1">#final_jnt_trips = pd.concat([jnt_trips_rsm]*scale_factor, ignore_index=True)</span>


        <span class="n">final_ind_trips</span> <span class="o">=</span> <span class="n">scaleup_to_rsm_samplingrate</span><span class="p">(</span><span class="n">ind_trips_rsm</span><span class="p">,</span> 
                                                      <span class="n">households</span><span class="p">,</span> 
                                                      <span class="n">taz_crosswalk</span><span class="p">,</span> 
                                                      <span class="n">scale_factor</span><span class="p">,</span> 
                                                      <span class="n">study_area_tazs</span><span class="o">=</span><span class="n">sa_rsm</span><span class="p">)</span>

        <span class="n">final_jnt_trips</span> <span class="o">=</span> <span class="n">scaleup_to_rsm_samplingrate</span><span class="p">(</span><span class="n">jnt_trips_rsm</span><span class="p">,</span> 
                                                      <span class="n">households</span><span class="p">,</span> 
                                                      <span class="n">taz_crosswalk</span><span class="p">,</span> 
                                                      <span class="n">scale_factor</span><span class="p">,</span>
                                                      <span class="n">study_area_tazs</span><span class="o">=</span><span class="n">sa_rsm</span><span class="p">)</span> 

    <span class="k">return</span> <span class="n">final_ind_trips</span><span class="p">,</span> <span class="n">final_jnt_trips</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": ["navigation.tabs", "content.code.annotate", "content.tabs.link", "navigation.indexes"], "search": "assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="assets/javascripts/bundle.78eede0e.min.js"></script>
      
    
  </body>
</html>